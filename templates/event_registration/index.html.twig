{# templates/event/register.html.twig #} {% extends 'base.html.twig' %} {% block title %}{{ 'event.register.title'|trans
}}{% endblock %} {% block body %}
<section id="hero" class="hero section dark-background">
    <img src="{{asset('assets/img/barb.jpg')}}" loading="lazy" alt="" data-aos="fade-in">
    <div class="container mt-4">
        <h2 data-aos="fade-up" data-aos-delay="100" style="color: #fff;">
            {{ 'event.register.hero.title'|trans({'%date%': '30 Mai 2025'}) }}
        </h2>

        <div class="d-flex mt-4" data-aos="fade-up" data-aos-delay="300">
            <a href="#barbecue" class="btn btn-success btn-lg rounded-pill px-5 py-3">{{
                'event.register.hero.button'|trans }}</a>
        </div>
    </div>
</section>

<section class="py-5 py-5 bg-light bg-gradient">
    <div class="container">
        {% for message in app.flashes('success') %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"
                aria-label="{{ 'common.alerts.close'|trans }}"></button>
        </div>
        {% endfor %} {% for message in app.flashes('error') %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"
                aria-label="{{ 'common.alerts.close'|trans }}"></button>
        </div>
        {% endfor %}

        <div id="barbecue" class="row g-4">
            <div class="col-md-12">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center mb-4">
                            <i class="bi bi-backpack-fill fs-1 text-success me-3"></i>

                            <h3 class="h4 fw-bold mb-0">
                                {{ 'event.register.card.title'|trans({'%date%': '30 Mai 2025'}) }}
                            </h3>
                        </div>
                        <div class="row">
                            <div class="col-md-7 mb-4">
                                <p>
                                    {{ 'event.register.card.greeting'|trans }}<br><br> {{
                                    'event.register.card.info'|trans({ '%date%': '<strong>vendredi 30 mai
                                        2025</strong>', '%time%': '<strong>9h</strong>', '%location%': '<strong>"La
                                        Corne d\'Or"</strong>' })|raw }}<br><br>

                                    <a href="https://maps.app.goo.gl/W1rg7G5U5o16uzNi6" target="_blank"
                                        class="text-success">
                                        <i class="bi bi-geo-alt-fill me-1"></i> {{
                                        'event.register.card.location_link'|trans }}
                                    </a><br><br> {{ 'event.register.card.description'|trans }}<br><br> {{
                                    'event.register.card.registration_info'|trans }}
                                </p>
                                <button class="btn btn-success rounded-pill px-4 mt-3" data-bs-toggle="modal"
                                    data-bs-target="#inscriptionModal">
                                    <i class="bi bi-calendar2-check me-2"></i> {{
                                    'event.register.card.register_button'|trans }}
                                </button>
                            </div>
                            <div class="col-md-5 d-flex align-items-center justify-content-center">
                                <img src="{{ asset('assets/img/barbecue.jpg') }}" loading="lazy"
                                    alt="{{ 'event.register.card.image_alt'|trans }}"
                                    class="img-fluid rounded-4 shadow">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Modal Inscription -->
<div class="modal fade" id="inscriptionModal" tabindex="-1" aria-labelledby="inscriptionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="inscriptionModalLabel">{{ 'event.register.modal.title'|trans({'%date%': '30
                    mai 2025'}) }}</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="{{ 'common.buttons.close'|trans }}"></button>
            </div>
            <div class="modal-body">
                <!-- Note importante dans un encadré -->
                <div class="alert alert-info mb-4">
                    <p class="mb-2"><strong><i class="bi bi-info-circle-fill me-2"></i>{{
                            'event.register.modal.important_info'|trans }}:</strong></p>
                    <ul class="mb-0">
                        <li>{{ 'event.register.modal.deadline'|trans({'%date%': '<strong>Mardi 20 mai
                                2025</strong>'})|raw }}</li>
                        <li>{{ 'event.register.modal.looking_forward'|trans }}</li>
                        <li><strong>{{ 'common.nb'|trans }}:</strong> {{ 'event.register.modal.limited_places'|trans }}
                        </li>
                    </ul>
                </div>

                {{ form_start(form, {'attr': {'id': 'inscription-form'}}) }}

                <!-- Afficher les informations utilisateur en lecture seule -->
                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-person-fill me-2 text-success"></i>{{
                            'event.register.modal.your_info'|trans }}</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form_row(form.firstName, {'attr': {'class': 'form-control-plaintext', 'readonly':
                                'readonly'}}) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_row(form.lastName, {'attr': {'class': 'form-control-plaintext', 'readonly':
                                'readonly'}}) }}
                            </div>
                        </div>
                        <div class="row mb-0">
                            <div class="col-md-6">
                                {{ form_row(form.email, {'attr': {'class': 'form-control-plaintext', 'readonly':
                                'readonly'}}) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_row(form.phone, {'attr': {'class': 'form-control-plaintext', 'readonly':
                                'readonly'}}) }}
                            </div>
                        </div>
                    </div>
                </div>

                <h5 class="mt-4 d-flex align-items-center">
                    <i class="bi bi-people-fill me-2 text-success"></i> {{ 'event.register.modal.add_guests'|trans }}
                </h5>
                <div data-prototype="{{ form_widget(form.guests.vars.prototype)|e('html_attr') }}"
                    class="guests-collection mb-3">
                    {% for guestForm in form.guests %}
                    <div class="guest-form row mb-2">
                        <div class="col-md-5">
                            {{ form_row(guestForm.firstName, {'label': 'event.register.form.first_name'|trans}) }}
                        </div>
                        <div class="col-md-5">
                            {{ form_row(guestForm.lastName, {'label': 'event.register.form.last_name'|trans}) }}
                        </div>
                        <div class="col-md-2 align-self-end">
                            <button type="button" class="btn btn-danger btn-sm remove-guest">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <button type="button" class="btn btn-primary btn-sm mb-3" id="add-guest">
                    <i class="bi bi-plus-circle me-1"></i> {{ 'event.register.modal.add_guest_button'|trans }}
                </button>

                <div>{{ form_row(form._token) }}</div>

                <button type="submit" class="btn btn-success w-100">
                    <i class="bi bi-check-circle-fill me-2"></i> {{ 'event.register.modal.confirm_button'|trans }}
                </button> {{ form_end(form) }}
            </div>
        </div>
    </div>
</div>

<script>
    // Modification du script pour ajouter un indicateur de chargement
    document.addEventListener('DOMContentLoaded', () => {
        const collectionHolder = document.querySelector('.guests-collection');
        const addBtn = document.getElementById('add-guest');
        const maxGuests = 4;
        const form = document.getElementById('inscription-form');
        const submitBtn = form.querySelector('button[type="submit"]');

        let index = collectionHolder.children.length;

        // Ajout d'un indicateur de chargement
        function showLoading() {
            // Désactiver le bouton et ajouter l'indicateur de chargement
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> ' +
                (submitBtn.textContent || 'Chargement...');
        }

        // Prévenir les soumissions multiples
        form.addEventListener('submit', function (e) {
            if (form.classList.contains('is-submitting')) {
                e.preventDefault();
                return false;
            }

            form.classList.add('is-submitting');
            showLoading();
            return true;
        });

        addBtn.addEventListener('click', () => {
            if (index < maxGuests) {
                // Créer un conteneur pour le nouveau guest
                const guestRow = document.createElement('div');
                guestRow.classList.add('guest-form', 'row', 'mb-2');

                // Récupérer le prototype et remplacer l'index
                let prototype = collectionHolder.dataset.prototype;
                prototype = prototype.replace(/__name__/g, index);

                // Définir les libellés de champs manuellement au lieu de les chercher dans le DOM
                const firstNameLabel = 'Prénom'; // Ou utiliser la traduction si disponible
                const lastNameLabel = 'Nom'; // Ou utiliser la traduction si disponible

                // Créer la structure HTML pour le nouveau guest
                guestRow.innerHTML = `
                <div class="col-md-5">
                    <div class="form-group">
                        <label for="event_registration_guests_${index}_firstName" class="form-label required">${firstNameLabel}</label>
                        <input type="text" id="event_registration_guests_${index}_firstName" name="event_registration[guests][${index}][firstName]" required="required" class="form-control">
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="form-group">
                        <label for="event_registration_guests_${index}_lastName" class="form-label required">${lastNameLabel}</label>
                        <input type="text" id="event_registration_guests_${index}_lastName" name="event_registration[guests][${index}][lastName]" required="required" class="form-control">
                    </div>
                </div>
                <div class="col-md-2 align-self-end">
                    <button type="button" class="btn btn-danger btn-sm remove-guest">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            `;

                // Ajouter la nouvelle ligne au conteneur
                collectionHolder.appendChild(guestRow);
                index++;
            }
        });

        // Gérer la suppression des guests
        collectionHolder.addEventListener('click', function (e) {
            if (e.target.classList.contains('remove-guest') || e.target.closest('.remove-guest')) {
                e.target.closest('.guest-form').remove();
                index--;
            }
        });
    });
</script>
{% endblock %}